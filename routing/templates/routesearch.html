{% extends 'base.html' %}


{% block header %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/routesearch_styles.css' %}">
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<main class="content">
    <h2>経路検索</h2>
    <p>検索条件を入力してください</p>

    <!-- 入力欄 -->
    <form action="/routesearch/" method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="start_spot">出発地点:</label>
            <select id="start_spot" name="start_spot">
                <option value="調布駅">調布駅</option>
                <option value="西調布駅">西調布駅</option>
            </select>
        </div>

        <div class="form-group">
            <label for="spot_num">経由地点数:</label>
            <input type="number" id="number_spot" name="number_spot" min="0" max="10" value="0" onchange="ChangeSpotNum()">
        </div>

        <div id="spots_container"></div>
        
        <div class="form-group">
            <label for="spot11">経由地点11:</label>
            <input type="text" id="spot11" name="spot11" placeholder="経由地点を入力" value="{{ spot_name11 }}" class="input-wide" />
            <label for="number11">箇所数11:</label>
            <input type="number" id="number11" name="number11" min="1" value="1" class="input-wide" />
        </div>
        
        <div class="form-group">
            <label for="goal_spot">到着地点:</label>
            <select id="goal_spot" name="goal_spot">
                <option value="電気通信大学">電気通信大学</option>
                <option value="つつじヶ丘駅">つつじヶ丘駅</option>
            </select>
        </div>    

        <div id="submit-btn">
            <input type="submit" value="探索">
        </div>
    </form>

    <hr>
    <div class="route-display-area">
        {% for route in routes %}
            <div class="route-wrapper">
                <!-- 経路情報部分 -->
                <div id="route-{{ forloop.counter }}" class="route-container">
                    <h4>{{ route.name }}</h4>
                    <p>距離: {{ route.distance }} m</p>  <!-- 距離の表示 -->
                    <p>時間: {{ route.time }} 分</p>     <!-- 時間の表示 -->
                    <p>出発: {{ start_spot }}</p>    <!-- 出発地点 -->
                    <p>経由地点:
                        <ol>
                            {% for via_spot in route.via_spots %}
                                <li>{{ via_spot }}</li>  <!-- 経由地点をリスト項目として表示 -->
                            {% endfor %}
                        </ol>
                    </p>
                    <p>出発: {{ goal_spot }}</p>    <!-- 到着地点 -->
                    {% load static %}
                </div>
                <!-- 地図部分 -->
                <div id="routemap-{{ forloop.counter }}" class="routemap-container">
                    <iframe src="{% static 'data/user_map5.html' %}" width="100%" height="600px" frameborder="0" style="float: right;"></iframe>
                </div>
            </div>
        {% endfor %}
    </div>
    
{% else %}
<div class="h1">
    アカウントを登録してください。アカウントをお持ちの方は、ログインしてください。
</div>
<!-- ログインされていなければログインページ表示 -->
<a href="{% url 'accounts:signup' %}" class="btn btn-primary">アカウント登録</a>
<a href="{% url 'accounts:login' %}" class="btn btn-primary">ログイン</a>
{% endif %}


<!-- JavaScriptの追加 -->
<script src="{% static 'scripts/routesearch_scripts.js' %}"></script>

{% endblock %}